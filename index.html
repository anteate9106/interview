<!DOCTYPE html>
<html lang="ko" data-page="admin">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- Vercel 배포: 2026-01-24 새 프로젝트 -->
    <title>청년들 입사지원 시스템 - 관리자</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📋</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script src="db.js"></script>
</head>
<body>
    <!-- 로그인 페이지 -->
    <div id="loginPage" class="page active">
        <div class="login-container">
            <div class="login-box">
                <h1>청년들 입사지원 시스템</h1>
                <p class="subtitle">입사지원서류 평가 시스템</p>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">아이디</label>
                        <input type="text" id="username" placeholder="아이디를 입력하세요" required>
                    </div>
                    <div class="form-group">
                        <label for="password">비밀번호</label>
                        <input type="password" id="password" placeholder="비밀번호를 입력하세요" required>
                    </div>
                    <button type="submit" class="btn-primary">로그인</button>
                </form>
            </div>
        </div>
    </div>

    <!-- 채용공고 선택 페이지 -->
    <div id="jobPostingPage" class="page">
        <nav class="navbar">
            <div class="nav-brand">청년들 입사지원 시스템</div>
            <div class="nav-actions">
                <a href="evaluator.html" class="btn-nav-link" target="_blank">평가자페이지</a>
                <a href="apply.html" class="btn-nav-link" target="_blank">지원자페이지</a>
                <button onclick="openGuideEditor()" class="btn-nav-link">작성안내관리</button>
                <button onclick="openJobPostingEditor()" class="btn-nav-link">채용공고관리</button>
                <button onclick="openEvaluatorEditor()" class="btn-nav-link">평가자관리</button>
                <button onclick="openEmailTemplateEditor()" class="btn-nav-link">메시지관리</button>
                <button onclick="openSecondRoundEditor()" class="btn-nav-link">2차서류전형관리</button>
                <span id="currentUserPosting" class="current-user"></span>
                <button onclick="logout()" class="btn-logout">로그아웃</button>
            </div>
        </nav>

        <div class="job-posting-container">
            <div class="page-header">
                <h1>채용평가관리</h1>
                <p class="subtitle">평가를 관리할 채용공고를 선택하세요</p>
            </div>

            <div class="job-posting-grid" id="jobPostingGrid">
                <!-- 동적 생성 -->
            </div>
        </div>
    </div>

    <!-- 평가자 비밀번호 변경 모달 (관리자용) -->
    <div id="changeEvaluatorPasswordModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>평가자 비밀번호 변경</h2>
                <button onclick="closeChangeEvaluatorPasswordModal()" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px; color: var(--text-secondary); font-size: 14px;">
                    평가자: <strong id="changePasswordEvaluatorName" style="color: var(--text-primary);"></strong>
                </p>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">새 비밀번호</label>
                    <input type="password" id="adminNewPassword" placeholder="새 비밀번호를 입력하세요 (최소 4자)" 
                           style="width: 100%; padding: 10px 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 14px;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">새 비밀번호 확인</label>
                    <input type="password" id="adminConfirmPassword" placeholder="새 비밀번호를 다시 입력하세요" 
                           style="width: 100%; padding: 10px 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 14px;">
                </div>
                <p style="font-size: 12px; color: var(--text-secondary); margin-top: 12px;">
                    ⚠️ 관리자는 현재 비밀번호 확인 없이 직접 비밀번호를 변경할 수 있습니다.
                </p>
            </div>
            <div class="modal-footer">
                <button onclick="closeChangeEvaluatorPasswordModal()" class="btn-secondary">취소</button>
                <button onclick="changeEvaluatorPasswordByAdmin()" class="btn-primary">변경</button>
            </div>
        </div>
    </div>

    <!-- 평가자 관리 모달 -->
    <div id="evaluatorEditorModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2>평가자 관리</h2>
                <button onclick="closeEvaluatorEditor()" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 24px;">
                    <h3 style="margin-bottom: 16px; color: var(--text-primary);">새 평가자 추가</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 12px; align-items: end;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary); font-size: 13px;">아이디</label>
                            <input type="text" id="newEvaluatorId" placeholder="예: evaluator1" 
                                   style="width: 100%; padding: 10px 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary); font-size: 13px;">비밀번호</label>
                            <input type="password" id="newEvaluatorPassword" placeholder="비밀번호" 
                                   style="width: 100%; padding: 10px 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary); font-size: 13px;">이름</label>
                            <input type="text" id="newEvaluatorName" placeholder="예: 평가자 1" 
                                   style="width: 100%; padding: 10px 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 14px;">
                        </div>
                        <button onclick="addNewEvaluator()" class="btn-add-item" style="white-space: nowrap;">+ 추가</button>
                    </div>
                </div>
                <div style="margin-top: 32px; padding-top: 32px; border-top: 2px solid var(--border-color);">
                    <h3 style="margin-bottom: 16px; color: var(--text-primary);">평가자 목록</h3>
                    <div id="evaluatorsContainer">
                        <!-- 동적 생성 -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeEvaluatorEditor()" class="btn-secondary">닫기</button>
            </div>
        </div>
    </div>

    <!-- 채용공고 관리 모달 -->
    <div id="jobPostingEditorModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2>채용공고 관리</h2>
                <button onclick="closeJobPostingEditor()" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 24px;">
                    <button onclick="addNewJobPosting()" class="btn-add-item">+ 새 채용공고 추가</button>
                </div>
                <div id="jobPostingsContainer">
                    <!-- 동적 생성 -->
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeJobPostingEditor()" class="btn-secondary">닫기</button>
            </div>
        </div>
    </div>

    <!-- 작성 안내 편집 모달 -->
    <div id="guideEditorModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2>작성 안내 관리</h2>
                <button onclick="closeGuideEditor()" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 작성 안내 섹션 -->
                <div style="margin-bottom: 32px;">
                    <h3 style="margin-bottom: 16px; color: var(--text-primary);">📋 작성 안내</h3>
                    <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">자유롭게 입력하세요</p>
                    <textarea id="guideItemsTextarea" rows="8" 
                              placeholder="모든 필수 항목(*)을 입력해주세요&#10;각 항목의 글자 수를 확인하세요&#10;비밀번호는 8자 이상 입력해주세요"
                              style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 14px; font-family: inherit; resize: vertical;"></textarea>
                </div>

                <!-- 작성 항목 섹션 -->
                <div style="margin-bottom: 32px;">
                    <h3 style="margin-bottom: 16px; color: var(--text-primary);">✍️ 작성 항목</h3>
                    <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">각 항목을 한 줄씩 자유롭게 입력하세요 (예: 자기소개서:2000, 자기소개서 2000자, 자기소개서 등)</p>
                    <textarea id="writingItemsTextarea" rows="8" 
                              placeholder="자기소개서:2000&#10;경력기술서 2000자&#10;지원동기 (2000자)&#10;입사 후 포부"
                              style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 14px; font-family: inherit; resize: vertical;"></textarea>
                </div>

                <!-- 문의 관리 섹션 -->
                <div style="margin-bottom: 32px; padding-top: 32px; border-top: 2px solid var(--border-color);">
                    <h3 style="margin-bottom: 16px; color: var(--text-primary);">📞 문의</h3>
                    <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">자유롭게 입력하세요</p>
                    <textarea id="contactTextarea" rows="6" 
                              placeholder="채용 관련 문의사항이 있으시면&#10;recruit@company.com&#10;으로 연락 주시기 바랍니다."
                              style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 14px; font-family: inherit; resize: vertical;"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeGuideEditor()" class="btn-secondary">취소</button>
                <button onclick="saveGuide()" class="btn-primary">저장</button>
            </div>
        </div>
    </div>

    <!-- 메인 평가 페이지 (3분할) -->
    <div id="mainPage" class="page">
        <nav class="navbar">
            <div class="nav-brand">청년들 입사지원 시스템</div>
            <div class="nav-actions">
                <a href="evaluator.html" class="btn-nav-link" target="_blank">평가자페이지</a>
                <a href="apply.html" class="btn-nav-link" target="_blank">지원자페이지</a>
                <button onclick="openGuideEditor()" class="btn-nav-link">작성안내관리</button>
                <button onclick="openJobPostingEditor()" class="btn-nav-link">채용공고관리</button>
                <button onclick="openEvaluatorEditor()" class="btn-nav-link">평가자관리</button>
                <button onclick="openEmailTemplateEditor()" class="btn-nav-link">메시지관리</button>
                <button onclick="openSecondRoundEditor()" class="btn-nav-link">2차서류전형관리</button>
                <span id="currentUser" class="current-user"></span>
                <button onclick="logout()" class="btn-logout">로그아웃</button>
            </div>
        </nav>

        <div class="main-layout">
            <!-- 왼쪽: 드롭다운 선택 -->
            <div class="left-panel">
                <div class="panel-header">
                    <h3>관리자 시스템</h3>
                </div>
                <div style="padding: 20px;">
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary); font-size: 14px;">채용공고 선택</label>
                        <select id="jobPostingSelect" onchange="onJobPostingChange()" style="width: 100%; padding: 10px 12px; border: 2px solid var(--primary-color); border-radius: 8px; font-size: 14px; font-weight: 600; color: var(--primary-color); background: white; cursor: pointer;">
                            <option value="">채용공고를 선택하세요</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary); font-size: 14px;">지원자 선택</label>
                        <select id="applicantSelect" onchange="onApplicantChange()" style="width: 100%; padding: 10px 12px; border: 2px solid var(--primary-color); border-radius: 8px; font-size: 14px; font-weight: 600; color: var(--primary-color); background: white; cursor: pointer;" disabled>
                            <option value="">지원자를 선택하세요</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 중간: 평가 내용 -->
            <div class="middle-panel">
                <div class="panel-header">
                    <h3>평가 내용</h3>
                    <div id="applicantInfoHeader">
                        <!-- 선택된 지원자 정보 -->
                    </div>
                </div>
                <div class="cover-letter-content" id="coverLetterContent">
                    <div class="empty-state">
                        <p>왼쪽에서 채용공고와 지원자를 선택하세요</p>
                    </div>
                </div>
            </div>

            <!-- 오른쪽: 평가 결과 -->
            <div class="right-panel">
                <div class="panel-header">
                    <h3>평가 결과</h3>
                </div>
                <div class="evaluation-content" id="evaluationContent">
                    <div class="empty-evaluation">
                        <div style="text-align: center; padding: 60px 20px; color: #94a3b8;">
                            <div style="font-size: 48px; margin-bottom: 16px;">📊</div>
                            <p style="font-size: 16px;">지원자를 선택하세요</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 이메일 템플릿 관리 모달 -->
    <div id="emailTemplateModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>📧 합격/불합격 메시지 관리</h2>
                <button onclick="closeEmailTemplateModal()" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">메시지 유형</label>
                    <select id="templateType" onchange="loadEmailTemplate()" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                        <option value="passed">합격 메시지</option>
                        <option value="failed">불합격 메시지</option>
                    </select>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">이메일 제목</label>
                    <input type="text" id="templateSubject" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;" placeholder="이메일 제목을 입력하세요">
                    <p style="font-size: 12px; color: #64748b; margin-top: 4px;">사용 가능한 변수: {이름}, {채용공고}</p>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">이메일 본문</label>
                    <textarea id="templateBody" rows="15" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; font-family: inherit; line-height: 1.6;" placeholder="이메일 본문을 입력하세요"></textarea>
                    <p style="font-size: 12px; color: #64748b; margin-top: 4px;">사용 가능한 변수: {이름}, {채용공고}</p>
                </div>
            </div>
            <div class="modal-footer" style="display: flex; gap: 12px; justify-content: flex-end; padding: 20px; border-top: 1px solid #e2e8f0;">
                <button onclick="closeEmailTemplateModal()" style="padding: 10px 20px; border: 1px solid #e2e8f0; border-radius: 8px; background: white; cursor: pointer;">취소</button>
                <button onclick="saveCurrentEmailTemplate()" style="padding: 10px 20px; border: none; border-radius: 8px; background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; cursor: pointer; font-weight: 600;">저장</button>
            </div>
        </div>
    </div>

    <!-- 설문조사 관리 모달 -->
    <div id="surveyModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2>📝 설문조사 항목 관리</h2>
                <button onclick="closeSurveyModal()" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 안내문 편집 섹션 -->
                <div style="margin-bottom: 30px; padding: 20px; background: #f8fafc; border-radius: 12px; border: 1px solid #e2e8f0;">
                    <h3 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; color: #1f2937;">📋 설문조사 안내문</h3>
                    <p style="margin: 0 0 12px 0; color: #64748b; font-size: 13px;">
                        설문조사 페이지 상단에 표시될 안내문을 작성해주세요.
                    </p>
                    <textarea id="surveyIntroText" rows="6" style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; font-family: inherit; line-height: 1.6;" placeholder="설문조사 안내문을 입력하세요"></textarea>
                </div>
                
                <div style="margin-bottom: 20px; padding: 16px; background: #f8fafc; border-radius: 8px;">
                    <p style="margin: 0; color: #64748b; font-size: 14px;">
                        💡 설문조사 항목을 추가, 수정, 삭제할 수 있습니다. 항목 번호 순서대로 표시됩니다.
                    </p>
                </div>
                
                <div id="surveyQuestionsList" style="margin-bottom: 20px;">
                    <!-- 동적으로 생성 -->
                </div>
                
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                    <button onclick="addNewSurveyQuestion()" style="padding: 10px 20px; border: 1px solid #6366f1; border-radius: 8px; background: white; color: #6366f1; cursor: pointer; font-weight: 600;">
                        + 새 항목 추가
                    </button>
                </div>
            </div>
            <div class="modal-footer" style="display: flex; gap: 12px; justify-content: flex-end; padding: 20px; border-top: 1px solid #e2e8f0;">
                <button onclick="closeSurveyModal()" style="padding: 10px 20px; border: 1px solid #e2e8f0; border-radius: 8px; background: white; cursor: pointer;">취소</button>
                <button onclick="saveAllSurveyQuestions(event)" id="saveSurveyBtn" style="padding: 10px 20px; border: none; border-radius: 8px; background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; cursor: pointer; font-weight: 600; transition: opacity 0.2s;">저장</button>
            </div>
        </div>
    </div>

    <!-- 2차 서류전형 질문지 관리 모달 -->
    <div id="secondRoundModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2>🎯 2차 서류전형 질문지 관리</h2>
                <button onclick="closeSecondRoundModal()" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 안내문 편집 섹션 -->
                <div style="margin-bottom: 30px; padding: 20px; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius: 12px; border: 1px solid #10b981;">
                    <h3 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; color: #065f46;">📋 2차 서류전형 안내문</h3>
                    <p style="margin: 0 0 12px 0; color: #047857; font-size: 13px;">
                        합격한 지원자에게 표시될 안내문을 작성해주세요.
                    </p>
                    <textarea id="secondRoundIntroText" rows="6" style="width: 100%; padding: 12px; border: 1px solid #10b981; border-radius: 8px; font-size: 14px; font-family: inherit; line-height: 1.6;" placeholder="2차 서류전형 안내문을 입력하세요"></textarea>
                </div>
                
                <div style="margin-bottom: 20px; padding: 16px; background: #f0fdf4; border-radius: 8px; border: 1px solid #10b981;">
                    <p style="margin: 0; color: #047857; font-size: 14px;">
                        💡 2차 서류전형 질문지를 추가, 수정, 삭제할 수 있습니다. 항목 번호 순서대로 표시됩니다.
                    </p>
                </div>
                
                <div id="secondRoundQuestionsList" style="margin-bottom: 20px;">
                    <!-- 동적으로 생성 -->
                </div>
                
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                    <button onclick="addNewSecondRoundQuestion()" style="padding: 10px 20px; border: 1px solid #10b981; border-radius: 8px; background: white; color: #10b981; cursor: pointer; font-weight: 600;">
                        + 새 항목 추가
                    </button>
                </div>
            </div>
            <div class="modal-footer" style="display: flex; gap: 12px; justify-content: flex-end; padding: 20px; border-top: 1px solid #e2e8f0;">
                <button onclick="closeSecondRoundModal()" style="padding: 10px 20px; border: 1px solid #e2e8f0; border-radius: 8px; background: white; cursor: pointer;">취소</button>
                <button onclick="saveAllSecondRoundQuestions(event)" id="saveSecondRoundBtn" style="padding: 10px 20px; border: none; border-radius: 8px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; cursor: pointer; font-weight: 600; transition: opacity 0.2s;">저장</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
